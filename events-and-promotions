<div class="header_banner events_banner">
    <div class="main_container">
        <h4 class="header_banner_heading">Events & Promotions</h4>
    </div>
</div>
<div class="main_container mobile_padding">
    <div class="details_row">
        <div class="details_col_3 hidden_phone">
            <a href="/events-and-promotions">
            <img src="//codecloud.cdn.speedyrails.net/sites/57f2b1016e6f645d03550000/image/jpeg/undefined/dtl_440x1200_side_events.jpg" /></a>
        </div>
        <div class="details_col_9">
            <h5 id="events_header" class="details_header accordion_header" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse1" aria-expanded="false" aria-controls="collapse1">
                Events
                <i class="fa fa-chevron-up pull-right"></i>
            </h5>
            <div id="collapse1" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading3">
                <div class="store_desc" id="events_container">
                    <div class="store_desc" id="no_events">
                        Check back soon for future Events!
                        <hr class="promo_separator" />
                    </div>
                    <script id="events_template" type="x-tmpl-mustache/text">
                        <div class="promo_row">
                            <div class="promo_col_3" style="{{promo_image}}">
                                <img src="{{event_image_url_abs}}" alt="Promotion" class="" />
                            </div>
                            <div class="promo_col_9" style="{{full_width}}">
                                <p class="colored_link"><a href="/events/{{slug}}">{{name}}</a></p>
                                <h3 class="publish_date">{{dates}}</h3>
                                <div class="details_desc">{{description_short}}</div>
                                <a href="/events/{{slug}}" class="read_more">Read More</a>
                            </div>
                        </div>
                        <hr class="promo_separator" />
                    </script>
                </div>
            </div>
            <h5 id="promotions_header" class="details_header accordion_header" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapse3" aria-expanded="false" aria-controls="collapse3">
                Promotions
                <i class="fa fa-chevron-up pull-right"></i>
            </h5>
            <div id="collapse3" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading3">
                <div class="store_desc" id="no_promotions">
                   Check back soon for future Promotions!
                    <hr class="promo_separator" />
                </div>
                <div class="store_desc" id="promos_container">
                    <script id="promos_template" type="x-tmpl-mustache/text">
                        <div class="promo_row">
                            <div class="promo_col_3" style="{{promo_image}}">
                                <img src="{{promo_image_url_abs}}" alt="Promotion" class="full_width" />
                            </div>
                            <div class="promo_col_9" style="{{full_width}}">
                                <p class="colored_link"><a href="/promotions/{{slug}}">{{name}}</a></p>
                                <h3 class="publish_date"><a href="/stores/{{store_detail_btn}}"><span class="promo_parent">{{store_name}} |</a> </span><br class="visible_phone" />{{dates}}</h3>
                                <div class="details_desc">{{description_short}}</div>
                                <a href="/promotions/{{slug}}" class="read_more">Read More</a>
                            </div>
                        </div>
                        <hr class="promo_separator" />
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function(e){
        init(e);
        loadMallDataCached(renderPage);
    })
    
    function renderPage(){
        var events = getEventsList().sortBy(function(o){ return o.start_date });
        var published_events = [];
        $.each( events , function( key, val ){
            today = moment();
            webDate = moment(val.show_on_web_date);
            if (today >= webDate) {
                published_events.push(val)
            } 
        });
        if (published_events.length > 0){
            renderEvents("#events_container","#events_template", published_events);
            $('#no_events').hide()
        } else {
            $('#events_header').click();
            $('#events_header').find('i').toggleClass('fa-chevron-down fa-chevron-up');
        }
        
        var promos = getPromotionsList().sortBy(function(o){ return o.start_date });
        var published_promos = [];
        $.each( promos , function( key, val ){
            today = moment();
            webDate = moment(val.show_on_web_date);
            if (today >= webDate) {
                published_promos.push(val)
            } 
        });
        if (published_promos.length > 0){
            renderPromotions("#promos_container","#promos_template", published_promos);
            $('#no_promotions').hide()
        } else {
            $('#promotions_header').click();
            $('#promotions_header').find('i').toggleClass('fa-chevron-down fa-chevron-up');
        }
        show_content();
    }
</script>